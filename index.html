<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Products Checkout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_CLIENT_ID&currency=USD&components=buttons,hosted-fields"></script>
    <style>
        .paypal-button-container:not(:last-child) { margin-bottom: 15px; }
        #paymentForm { max-width: 500px; margin: 2rem auto; }
        .input-group { margin-bottom: 1.5rem; }
        .generated-link { word-break: break-all; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <form id="paymentForm" class="bg-white rounded-lg shadow-md p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">Digital Product Checkout</h1>

            <div class="input-group">
                <label class="block text-gray-700 mb-2">Client ID</label>
                <input type="text" id="clientId" 
                    class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter your PayPal Client ID">
            </div>

            <div class="input-group">
                <label class="block text-gray-700 mb-2">Product Description</label>
                <textarea id="itemDescription" rows="3"
                    class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                    placeholder="Product details..."></textarea>
            </div>

            <div class="input-group grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 mb-2">Amount</label>
                    <input type="number" id="amount" step="0.01" 
                        class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                        placeholder="0.00">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Currency</label>
                    <select id="currency" 
                        class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                        <option value="USD">USD</option>
                        <option value="CAD">CAD</option>
                        <option value="AUD">AUD</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <button type="button" onclick="generateLink()" 
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                    Generate Payment Link
                </button>
            </div>

            <div id="paypalButtons" class="mt-6"></div>
            <div id="linkContainer" class="hidden mt-4 p-4 bg-gray-50 rounded-md"></div>
        </form>
    </div>

<script>
let paypalButtons;
const queryParams = new URLSearchParams(window.location.search);

// Initialize with URL parameters
if(queryParams.has('amount')) {
    document.getElementById('amount').value = queryParams.get('amount');
    document.getElementById('currency').value = queryParams.get('currency');
    document.getElementById('itemDescription').value = queryParams.get('desc');
}

function generateLink() {
    const amount = document.getElementById('amount').value;
    const currency = document.getElementById('currency').value;
    const desc = encodeURIComponent(document.getElementById('itemDescription').value);
    
    const link = `${window.location.href.split('?')[0]}?amount=${amount}&currency=${currency}&desc=${desc}`;
    
    document.getElementById('linkContainer').innerHTML = `
        <p class="text-sm text-gray-600 mb-2">Payment Link:</p>
        <div class="generated-link text-blue-600">${link}</div>
    `;
    document.getElementById('linkContainer').classList.remove('hidden');
}

function initPayPal() {
    const clientId = document.getElementById('clientId').value;
    
    // Reload SDK with new client ID
    const script = document.createElement('script');
    script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}&currency=${document.getElementById('currency').value}&components=buttons,hosted-fields`;
    script.onload = () => {
        paypalButtons = paypal.Buttons({
            style: {
                layout: 'vertical',
                color: 'gold',
                shape: 'rect',
                label: 'paypal'
            },
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: document.getElementById('amount').value,
                            currency_code: document.getElementById('currency').value
                        },
                        description: document.getElementById('itemDescription').value,
                        category: 'DIGITAL_GOODS',
                        items: [{
                            name: 'Digital Product',
                            description: document.getElementById('itemDescription').value,
                            quantity: '1',
                            category: 'DIGITAL_GOODS',
                            unit_amount: {
                                value: document.getElementById('amount').value,
                                currency_code: document.getElementById('currency').value
                            }
                        }]
                    }],
                    application_context: {
                        shipping_preference: 'NO_SHIPPING'
                    }
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('Payment completed successfully!');
                });
            }
        }).render('#paypalButtons');
    };
    document.body.appendChild(script);
}

document.getElementById('clientId').addEventListener('change', initPayPal);
document.getElementById('currency').addEventListener('change', initPayPal);
initPayPal();
</script>
</body>
</html>
