<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数字商品支付 - 安全便捷</title>
    <!-- 引入Tailwind CSS美化界面 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_CLIENT_ID&currency=USD&components=buttons,hosted-fields"></script>
    <style>
        .paypal-card {
            background: linear-gradient(145deg, #f8fafc, #f1f5f9);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        #cardForm iframe {
            border-radius: 0.5rem !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <div class="paypal-card p-8 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">数字商品购买</h1>
            
            <!-- 配置表单 -->
            <div class="space-y-4 mb-8">
                <div>
                    <label class="block text-sm font-medium text-gray-700">PayPal Client ID</label>
                    <input type="text" id="clientId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="输入Client ID">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">订单金额</label>
                        <input type="number" id="amount" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">货币类型</label>
                        <select id="currency" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="USD">USD</option>
                            <option value="CAD">CAD</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">商品描述</label>
                    <textarea id="description" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="请输入商品详细描述"></textarea>
                </div>

                <div class="partner-section">
                    <label class="block text-sm font-medium text-gray-700">合作伙伴分润</label>
                    <div class="space-y-2 mt-2">
                        <div class="flex space-x-2">
                            <input type="email" placeholder="PayPal邮箱" class="flex-1 rounded-md border-gray-300 shadow-sm" data-partner-email>
                            <input type="number" step="0.1" placeholder="百分比" class="w-24 rounded-md border-gray-300 shadow-sm" data-partner-percent>
                        </div>
                    </div>
                    <button type="button" onclick="addPartner()" class="mt-2 text-sm text-blue-600 hover:text-blue-800">+ 添加分润伙伴</button>
                </div>
            </div>

            <button onclick="generatePayment()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-md transition-colors">生成支付链接</button>
            
            <!-- 支付按钮容器 -->
            <div id="paypal-button-container" class="mt-6"></div>
            <div id="cardForm" class="hidden mt-4"></div>
        </div>
    </div>

    <script>
        let partners = [];
        
        // 添加合作伙伴
        function addPartner() {
            const email = document.querySelector('[data-partner-email]').value;
            const percent = document.querySelector('[data-partner-percent]').value;
            if(email && percent) {
                partners.push({ email, value: (percent/100) });
                alert('已添加合作伙伴');
            }
        }

        // 生成支付链接
        async function generatePayment() {
            const clientId = document.getElementById('clientId').value;
            const amount = document.getElementById('amount').value;
            const currency = document.getElementById('currency').value;
            const description = document.getElementById('description').value;

            // 动态加载PayPal SDK
            const script = document.createElement('script');
            script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}&currency=${currency}&components=buttons,hosted-fields`;
            document.body.appendChild(script);

            // 初始化支付按钮
            script.onload = () => {
                paypal.Buttons({
                    style: {
                        layout: 'vertical',
                        color: 'gold',
                        shape: 'pill',
                        label: 'paypal'
                    },
                    createOrder: function(data, actions) {
                        return actions.order.create({
                            purchase_units: [{
                                custom_id: 'DIGITAL_GOODS',
                                description: description,
                                category: 'DIGITAL_GOODS',
                                amount: {
                                    currency_code: currency,
                                    value: amount,
                                    breakdown: {
                                        item_total: { value: amount, currency_code: currency }
                                    }
                                },
                                items: [{
                                    name: description,
                                    quantity: '1',
                                    category: 'DIGITAL_GOODS',
                                    unit_amount: { value: amount, currency_code: currency }
                                }],
                                payment_instruction: {
                                    platform_fees: partners.map(p => ({
                                        amount: { value: (p.value * amount).toFixed(2), currency_code: currency },
                                        payee: { email_address: p.email }
                                    }))
                                }
                            }],
                            application_context: {
                                shipping_preference: 'NO_SHIPPING'
                            }
                        });
                    },
                    onApprove: function(data, actions) {
                        return actions.order.capture().then(details => {
                            alert('支付成功! 交易ID: ' + data.orderID);
                        });
                    }
                }).render('#paypal-button-container');

                // 信用卡支付处理
                paypal.HostedFields.render({
                    createOrder: () => document.getElementById('amount').value,
                    styles: {
                        input: { 'font-size': '16px', 'color': '#3d3d3d' }
                    },
                    fields: {
                        number: { selector: '#card-number' },
                        cvv: { selector: '#cvv' },
                        expirationDate: { selector: '#exp-date' }
                    }
                }).then(hostedFields => {
                    document.getElementById('cardForm').innerHTML = `
                        <div class="space-y-3">
                            <div id="card-number" class="p-2 bg-white"></div>
                            <div class="grid grid-cols-2 gap-3">
                                <div id="exp-date" class="p-2 bg-white"></div>
                                <div id="cvv" class="p-2 bg-white"></div>
                            </div>
                        </div>
                    `;
                    document.getElementById('cardForm').classList.remove('hidden');
                });
            };
        }
    </script>
</body>
</html>
